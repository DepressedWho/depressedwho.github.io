<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Admin - Depressed Who?</title>
    <link rel="stylesheet" href="blog-style.css">
</head>
<body>
    <div class="cursor"></div>
    <div class="cursor-follower"></div>
    <div class="bg-grid"></div>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="holo-card">
                <h1 class="glitch" data-text="Admin Login">Admin Login</h1>
                <p style="opacity: 0.8; margin-bottom: 2rem; text-align: center;">Sign in to manage Depressed Who?</p>
                
                <form id="loginForm">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" placeholder="admin@depressedwho.org" required>
                    </div>

                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    </div>

                    <div style="text-align: center; margin-top: 2rem;">
                        <button type="submit" class="btn">Sign In</button>
                    </div>

                    <p id="loginError" style="color: #ff0088; text-align: center; margin-top: 1rem; display: none;"></p>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard (hidden until logged in) -->
    <div class="admin-container" id="adminDashboard" style="display: none;">
        <!-- Header -->
        <header class="admin-header">
            <h1 class="glitch" data-text="Blog Admin">Blog Admin</h1>
            <div class="header-actions">
                <span id="userEmail" style="opacity: 0.7; margin-right: 1rem;"></span>
                <button class="btn btn-secondary" onclick="window.location.href='index.html'">Back to Site</button>
                <button class="btn" id="createNewBtn">+ New Post</button>
                <button class="btn" id="updateStatsBtn">Update Stats</button>
                <button class="btn btn-danger" id="logoutBtn">Logout</button>
            </div>
        </header>

        <!-- Update Stats Form -->
        <div class="post-form-container" id="statsFormContainer" style="display: none;">
            <div class="holo-card">
                <div class="form-header">
                    <h2>Update Site Settings</h2>
                    <button class="close-btn" id="closeStatsBtn">‚úï</button>
                </div>
                <form id="statsForm">
                    <div class="form-group">
                        <label>Number of People Helped</label>
                        <input type="number" id="peopleHelpedInput" min="0" placeholder="Enter number..." required>
                        <p style="opacity: 0.7; font-size: 0.9rem; margin-top: 0.5rem;">This number will appear on the homepage.</p>
                    </div>

                    <div class="form-group">
                        <label>Next Application Opening Date</label>
                        <input type="text" id="applicationDateInput" placeholder="e.g., Feb 1, 2026">
                        <p style="opacity: 0.7; font-size: 0.9rem; margin-top: 0.5rem;">This date will appear on the Apply page.</p>
                    </div>

                    <div class="form-group">
                        <label>Discord Server Link</label>
                        <input type="url" id="discordLinkInput" placeholder="https://discord.gg/yourlink">
                        <p style="opacity: 0.7; font-size: 0.9rem; margin-top: 0.5rem;">Link to your Discord server.</p>
                    </div>

                    <div class="form-group">
                        <label>Google Forms Application Link</label>
                        <input type="url" id="googleFormsLinkInput" placeholder="https://forms.google.com/yourform">
                        <p style="opacity: 0.7; font-size: 0.9rem; margin-top: 0.5rem;">Link to your application form.</p>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelStatsBtn">Cancel</button>
                        <button type="submit" class="btn">Update Settings</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Create/Edit Post Form -->
        <div class="post-form-container" id="postFormContainer" style="display: none;">
            <div class="holo-card">
                <div class="form-header">
                    <h2 id="formTitle">Create New Post</h2>
                    <button class="close-btn" id="closeFormBtn">‚úï</button>
                </div>
                <form id="postForm">
                    <input type="hidden" id="postId">
                    
                    <div class="form-group">
                        <label>Post Title</label>
                        <input type="text" id="postTitle" placeholder="Enter an engaging title..." required>
                    </div>

                    <div class="form-group">
                        <label>Author Name</label>
                        <input type="text" id="postAuthor" placeholder="Your name..." required>
                    </div>

                    <div class="form-group">
                        <label>Emoji Icon</label>
                        <input type="text" id="postEmoji" placeholder="Pick an emoji (e.g., üí≠, üéÆ, üåô)" maxlength="2" required>
                    </div>

                    <div class="form-group">
                        <label>Short Description</label>
                        <textarea id="postDescription" rows="3" placeholder="A brief description (shown on blog cards)..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label>Full Content</label>
                        <textarea id="postContent" rows="10" placeholder="Write your full blog post here..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label>Tags (comma separated)</label>
                        <input type="text" id="postTags" placeholder="e.g., Recovery Story, Personal, Tips">
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
                        <button type="submit" class="btn">Save Post</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Posts List -->
        <div class="posts-list" id="postsList">
            <h2>All Blog Posts</h2>
            <div id="postsGrid" class="admin-posts-grid">
                <div class="loading-spinner" style="text-align: center; padding: 4rem; grid-column: 1/-1;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">‚è≥</div>
                    <p style="opacity: 0.7;">Loading posts...</p>
                </div>
            </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="holo-card" style="text-align: center; padding: 4rem;">
                <h2 style="font-size: 2rem; margin-bottom: 1rem;">No Posts Yet</h2>
                <p style="opacity: 0.8; margin-bottom: 2rem;">Create your first blog post to get started!</p>
                <button class="btn" onclick="document.getElementById('createNewBtn').click()">Create First Post</button>
            </div>
        </div>
    </div>

    <!-- Modal for viewing full post -->
    <div class="modal" id="viewModal" style="display: none;">
        <div class="modal-content">
            <button class="close-btn" onclick="closeViewModal()">‚úï</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, doc, getDoc, setDoc, deleteDoc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC7PLmCAiTW4hbMBQjigmyxlFTrE2I7txw",
            authDomain: "depressed-who.firebaseapp.com",
            projectId: "depressed-who",
            storageBucket: "depressed-who.firebasestorage.app",
            messagingSenderId: "561250743959",
            appId: "1:561250743959:web:9210fe84c298c9d7191bd2"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Make available globally
        window.db = db;
        window.auth = auth;
        window.firebaseModules = { collection, getDocs, doc, getDoc, setDoc, deleteDoc, updateDoc, signInWithEmailAndPassword, signOut, onAuthStateChanged };
        
        // Signal that Firebase is ready
        window.firebaseReady = true;
        document.dispatchEvent(new Event('firebaseReady'));
    </script>
    
    <script src="blog-admin.js"></script>
</body>
</html>